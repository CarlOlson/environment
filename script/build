#!/usr/bin/env fish

cd (dirname (status --current-filename))/..

if uname -a | grep Darwin
    set -x PATH $HOME/.nix-profile/bin $PATH
    set -x NIXPKGS_ALLOW_UNSUPPORTED_SYSTEM 1
end

set -x NIXPKGS_ALLOW_UNFREE 1

emacs -Q -nw --load pre-tangle.el --file init.org -f org-babel-tangle -f kill-emacs

if awesome --check -c awesome/rc.lua
    home-manager switch -f home.nix
end

pkill emacs

source fish/config.fish
